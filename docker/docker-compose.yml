services:
  # ─────────────────────────────────────────────
  # PicoClaw Init (one-shot bootstrap)
  #   docker compose -f docker/docker-compose.yml --profile init run --rm picoclaw-init
  # ─────────────────────────────────────────────
  picoclaw-init:
    image: picoclaw-local:dev
    build:
      context: ..
      dockerfile: docker/Dockerfile
    container_name: picoclaw-init
    profiles:
      - init
    volumes:
      - ./data:/home/picoclaw/.picoclaw
    command: ["onboard"]

  # ─────────────────────────────────────────────
  # PicoClaw Agent (one-shot query)
  #   docker compose -f docker/docker-compose.yml --profile agent run --rm picoclaw-agent -m "Hello"
  # ─────────────────────────────────────────────
  picoclaw-agent:
    image: picoclaw-local:dev
    build:
      context: ..
      dockerfile: docker/Dockerfile
    container_name: picoclaw-agent
    profiles:
      - agent
    # Uncomment to access host network; leave commented unless needed.
    #extra_hosts:
    #  - "host.docker.internal:host-gateway"
    volumes:
      - ./data:/home/picoclaw/.picoclaw
    entrypoint: ["/entrypoint.sh", "agent"]
    stdin_open: true
    tty: true

  # ─────────────────────────────────────────────
  # PicoClaw Gateway (Long-running Bot)
  #   docker compose -f docker/docker-compose.yml --profile gateway up picoclaw-gateway
  # ─────────────────────────────────────────────
  picoclaw-gateway:
    image: picoclaw-local:dev
    build:
      context: ..
      dockerfile: docker/Dockerfile
    container_name: picoclaw-gateway
    restart: on-failure
    profiles:
      - gateway
    # Uncomment to access host network; leave commented unless needed.
    #extra_hosts:
    #  - "host.docker.internal:host-gateway"
    volumes:
      - ./data:/home/picoclaw/.picoclaw

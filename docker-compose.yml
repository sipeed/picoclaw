services:
  # ─────────────────────────────────────────────
  # ClawDroid Agent (one-shot query)
  #   docker compose run --rm clawdroid-agent -m "Hello"
  # ─────────────────────────────────────────────
  clawdroid-agent:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: clawdroid-agent
    profiles:
      - agent
    volumes:
      - ./config/config.json:/root/.clawdroid/config.json:ro
      - clawdroid-workspace:/root/.clawdroid/workspace
    entrypoint: ["clawdroid", "agent"]
    stdin_open: true
    tty: true

  # ─────────────────────────────────────────────
  # ClawDroid Gateway (Long-running Bot)
  #   docker compose up clawdroid-gateway
  # ─────────────────────────────────────────────
  clawdroid-gateway:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: clawdroid-gateway
    restart: unless-stopped
    profiles:
      - gateway
    volumes:
      # Configuration file
      - ./config/config.json:/root/.clawdroid/config.json:ro
      # Persistent workspace (sessions, memory, logs)
      - clawdroid-workspace:/root/.clawdroid/workspace
    command: ["gateway"]

volumes:
  clawdroid-workspace:
